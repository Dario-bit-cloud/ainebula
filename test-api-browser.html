<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test API OpenRouter - Nebula AI</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .container {
      background: #2a2a2a;
      padding: 30px;
      border-radius: 12px;
      border: 1px solid #3a3a3a;
    }
    h1 {
      margin-top: 0;
      color: #4a9eff;
    }
    button {
      background: #4a9eff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 0;
    }
    button:hover {
      background: #3a8eef;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    .log {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      white-space: pre-wrap;
      max-height: 500px;
      overflow-y: auto;
      border: 1px solid #3a3a3a;
    }
    .success { color: #4ade80; }
    .error { color: #f87171; }
    .info { color: #60a5fa; }
    .config {
      background: #252525;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Test API OpenRouter</h1>
    
    <div class="config">
      <strong>Configurazione:</strong><br>
      Base URL: <span id="baseUrl">-</span><br>
      Model: <span id="model">-</span><br>
      API Key: <span id="apiKey">-</span>
    </div>
    
    <button id="testBtn" onclick="testAPI()">üöÄ Testa API</button>
    
    <div id="log" class="log">Clicca il pulsante per testare l'API...</div>
  </div>

  <script type="module">
    const API_CONFIG = {
      baseURL: 'https://openrouter.ai/api/v1',
      apiKey: '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',
      timeout: 30000
    };

    const MODEL_MAPPING = {
      'nebula-5.1-instant': 'google/gemini-flash-1.5-8b:free'
    };

    // Mostra configurazione
    document.getElementById('baseUrl').textContent = API_CONFIG.baseURL;
    document.getElementById('model').textContent = MODEL_MAPPING['nebula-5.1-instant'];
    document.getElementById('apiKey').textContent = API_CONFIG.apiKey.substring(0, 20) + '...';

    window.testAPI = async function() {
      const logEl = document.getElementById('log');
      const btnEl = document.getElementById('testBtn');
      
      btnEl.disabled = true;
      logEl.innerHTML = 'üîÑ Test in corso...\n\n';
      
      const log = (message, type = 'info') => {
        const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
        logEl.innerHTML += `<span class="${type}">${prefix} ${message}</span>\n`;
        logEl.scrollTop = logEl.scrollHeight;
      };
      
      try {
        const testMessage = 'Ciao! Funziona?';
        const apiModel = MODEL_MAPPING['nebula-5.1-instant'];
        
        log(`Base URL: ${API_CONFIG.baseURL}`);
        log(`Model: ${apiModel}`);
        log(`Message: ${testMessage}`);
        log('');
        
        const requestBody = {
          model: apiModel,
          messages: [
            {
              role: 'system',
              content: 'Sei Nebula AI, un assistente AI utile, amichevole e professionale. Rispondi sempre in italiano.'
            },
            {
              role: 'user',
              content: testMessage
            }
          ],
          temperature: 0.7,
          max_tokens: 2000
        };
        
        log('üì§ Invio richiesta...');
        
        const headers = {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${API_CONFIG.apiKey}`,
          'HTTP-Referer': window.location.origin,
          'X-Title': 'Nebula AI Test'
        };
        
        const startTime = Date.now();
        const response = await fetch(`${API_CONFIG.baseURL}/chat/completions`, {
          method: 'POST',
          headers: headers,
          body: JSON.stringify(requestBody)
        });
        const duration = Date.now() - startTime;
        
        log(`üì• Risposta ricevuta in ${duration}ms`);
        log(`Status: ${response.status} ${response.statusText}`);
        log('');
        
        if (!response.ok) {
          const errorText = await response.text();
          log(`Errore HTTP: ${response.status}`, 'error');
          log(`Risposta: ${errorText}`, 'error');
          
          try {
            const errorData = JSON.parse(errorText);
            log(`Errore dettagliato: ${JSON.stringify(errorData, null, 2)}`, 'error');
          } catch (e) {
            log('(Risposta non √® JSON valido)', 'error');
          }
          
          btnEl.disabled = false;
          return;
        }
        
        const data = await response.json();
        log('Risposta JSON ricevuta:', 'success');
        log(JSON.stringify(data, null, 2));
        log('');
        
        if (data.choices && data.choices.length > 0 && data.choices[0].message) {
          const aiResponse = data.choices[0].message.content;
          log('üí¨ Risposta AI:', 'success');
          log(aiResponse, 'success');
          log('');
          log('‚úÖ Test completato con successo!', 'success');
        } else {
          log('‚ùå Nessuna risposta valida nei dati', 'error');
        }
        
      } catch (error) {
        log(`Errore: ${error.name}`, 'error');
        log(`Messaggio: ${error.message}`, 'error');
        if (error.stack) {
          log(`Stack: ${error.stack}`, 'error');
        }
      } finally {
        btnEl.disabled = false;
      }
    };
  </script>
</body>
</html>

